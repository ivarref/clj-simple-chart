(ns clj-simple-chart.demotwo
  (:require [clj-simple-chart.core :refer :all]
            [clj-simple-chart.rect :as rect]))

(def margin {:top 75 :bottom 40 :left 40 :right 40})
(def width (- (/ 1024 1) (:left margin) (:right margin)))
(def height (- (/ 512 1) (:top margin) (:bottom margin)))

(def y (scale {:type          :ordinal
               :axis          :y
               :orientation   :left
               :width         width
               :height        height
               :domain        [1990 1991 1992 1993]
               :sub-domain    ["cats" "dogs" "birds"]
               :fill          ["red" "green" "blue"]
               :stack         :sideways
               :stack-opts    {:padding-inner 0.1}
               :padding-inner 0.2
               :padding-outer 0.1}))

(def x (scale {:type        :linear
               :axis        :x
               :orientation :bottom
               :ticks       5
               :width       width
               :height      height
               :domain      [0 100]}))

(def rect (rect/scaled-rect x y))

(def rects
  [{:p 1990 :c "cats" :h 10}
   {:p 1990 :c "dogs" :h 20}
   {:p 1990 :c "birds" :h 30}
   {:p 1991 :c "cats" :h 10}
   {:p 1991 :c "dogs" :h 20}
   {:p 1991 :c "birds" :h 30}])

(defn diagram []
  [:svg (svg-attrs width height margin)
   (title "Some values")
   (sub-title "1990 - 1995")
   [:g {:transform (translate (:left margin) (:top margin))}
    (render-axis y)
    (render-axis x)
    (rect rects)

    [:path {:transform (translate 0 54) :d "M14.91-54L14.91-33.96L14.91-33.96Q16.70-36.21 19.14-37.48L19.14-37.48L19.14-37.48Q21.59-38.74 24.61-38.74L24.61-38.74L24.61-38.74Q27.46-38.74 29.79-37.93L29.79-37.93L29.79-37.93Q32.13-37.13 33.82-35.33L33.82-35.33L33.82-35.33Q35.51-33.54 36.44-30.66L36.44-30.66L36.44-30.66Q37.37-27.77 37.37-23.63L37.37-23.63L37.37 0L25.49 0L25.49-23.70L25.49-23.70Q25.49-25.42 25.12-26.56L25.12-26.56L25.12-26.56Q24.75-27.70 24.05-28.39L24.05-28.39L24.05-28.39Q23.34-29.07 22.34-29.34L22.34-29.34L22.34-29.34Q21.34-29.60 20.07-29.60L20.07-29.60L20.07-29.60Q18.11-29.60 16.86-28.99L16.86-28.99L16.86-28.99Q15.61-28.37 14.91-27.28L14.91-27.28L14.91 0L3.06 0L3.06-54L14.91-54ZM62.37 0.70L62.37 0.70L62.37 0.70Q57.73 0.70 54.07-0.77L54.07-0.77L54.07-0.77Q50.41-2.25 47.92-4.78L47.92-4.78L47.92-4.78Q45.42-7.31 44.10-10.65L44.10-10.65L44.10-10.65Q42.79-13.99 42.79-17.75L42.79-17.75L42.79-19.09L42.79-19.09Q42.79-23.24 43.93-26.84L43.93-26.84L43.93-26.84Q45.07-30.45 47.37-33.08L47.37-33.08L47.37-33.08Q49.68-35.72 53.10-37.23L53.10-37.23L53.10-37.23Q56.53-38.74 61.10-38.74L61.10-38.74L61.10-38.74Q65.14-38.74 68.36-37.44L68.36-37.44L68.36-37.44Q71.58-36.14 73.81-33.71L73.81-33.71L73.81-33.71Q76.04-31.29 77.22-27.84L77.22-27.84L77.22-27.84Q78.40-24.40 78.40-20.11L78.40-20.11L78.40-15.29L54.84-15.29L54.84-15.29Q55.48-12.09 57.62-10.27L57.62-10.27L57.62-10.27Q59.77-8.44 63.18-8.44L63.18-8.44L63.18-8.44Q65.60-8.44 67.94-9.35L67.94-9.35L67.94-9.35Q70.28-10.27 71.96-12.38L71.96-12.38L77.38-5.98L77.38-5.98Q76.46-4.71 75.04-3.52L75.04-3.52L75.04-3.52Q73.62-2.32 71.72-1.39L71.72-1.39L71.72-1.39Q69.82-0.46 67.46 0.12L67.46 0.12L67.46 0.12Q65.11 0.70 62.37 0.70M61.03-29.60L61.03-29.60L61.03-29.60Q59.52-29.60 58.43-29.07L58.43-29.07L58.43-29.07Q57.34-28.55 56.62-27.63L56.62-27.63L56.62-27.63Q55.90-26.72 55.48-25.45L55.48-25.45L55.48-25.45Q55.05-24.19 54.84-22.71L54.84-22.71L66.80-22.71L66.80-23.63L66.80-23.63Q66.87-26.47 65.36-28.04L65.36-28.04L65.36-28.04Q63.84-29.60 61.03-29.60ZM95.66-54L95.66 0L83.78 0L83.78-54L95.66-54ZM115.45-54L115.45 0L103.57 0L103.57-54L115.45-54ZM121.25-18.63L121.25-19.37L121.25-19.37Q121.25-23.52 122.45-27.07L122.45-27.07L122.45-27.07Q123.64-30.62 125.96-33.22L125.96-33.22L125.96-33.22Q128.29-35.82 131.71-37.28L131.71-37.28L131.71-37.28Q135.14-38.74 139.57-38.74L139.57-38.74L139.57-38.74Q144.07-38.74 147.50-37.28L147.50-37.28L147.50-37.28Q150.93-35.82 153.25-33.22L153.25-33.22L153.25-33.22Q155.57-30.62 156.76-27.07L156.76-27.07L156.76-27.07Q157.96-23.52 157.96-19.37L157.96-19.37L157.96-18.63L157.96-18.63Q157.96-14.45 156.78-10.92L156.78-10.92L156.78-10.92Q155.60-7.38 153.28-4.80L153.28-4.80L153.28-4.80Q150.96-2.21 147.53-0.76L147.53-0.76L147.53-0.76Q144.11 0.70 139.64 0.70L139.64 0.70L139.64 0.70Q135.18 0.70 131.75-0.76L131.75-0.76L131.75-0.76Q128.32-2.21 125.98-4.80L125.98-4.80L125.98-4.80Q123.64-7.38 122.45-10.92L122.45-10.92L122.45-10.92Q121.25-14.45 121.25-18.63L121.25-18.63M133.10-19.37L133.10-18.63L133.10-18.63Q133.10-16.49 133.40-14.63L133.40-14.63L133.40-14.63Q133.70-12.76 134.46-11.39L134.46-11.39L134.46-11.39Q135.21-10.02 136.48-9.23L136.48-9.23L136.48-9.23Q137.74-8.44 139.64-8.44L139.64-8.44L139.64-8.44Q141.50-8.44 142.75-9.23L142.75-9.23L142.75-9.23Q144-10.02 144.74-11.39L144.74-11.39L144.74-11.39Q145.48-12.76 145.79-14.63L145.79-14.63L145.79-14.63Q146.11-16.49 146.11-18.63L146.11-18.63L146.11-19.37L146.11-19.37Q146.11-21.45 145.81-23.31L145.81-23.31L145.81-23.31Q145.51-25.17 144.76-26.56L144.76-26.56L144.76-26.56Q144-27.95 142.73-28.78L142.73-28.78L142.73-28.78Q141.47-29.60 139.57-29.60L139.57-29.60L139.57-29.60Q137.71-29.60 136.46-28.78L136.46-28.78L136.46-28.78Q135.21-27.95 134.47-26.56L134.47-26.56L134.47-26.56Q133.73-25.17 133.42-23.31L133.42-23.31L133.42-23.31Q133.10-21.45 133.10-19.37L133.10-19.37ZM207.98-38.04L213.96-15.61L217.79-38.04L229.15-38.04L220.18 0L210.16 0L203.87-22.57L197.54 0L187.52 0L178.56-38.04L189.91-38.04L193.68-15.08L199.72-38.04L207.98-38.04ZM231.89-18.63L231.89-19.37L231.89-19.37Q231.89-23.52 233.09-27.07L233.09-27.07L233.09-27.07Q234.28-30.62 236.60-33.22L236.60-33.22L236.60-33.22Q238.92-35.82 242.35-37.28L242.35-37.28L242.35-37.28Q245.78-38.74 250.21-38.74L250.21-38.74L250.21-38.74Q254.71-38.74 258.13-37.28L258.13-37.28L258.13-37.28Q261.56-35.82 263.88-33.22L263.88-33.22L263.88-33.22Q266.20-30.62 267.40-27.07L267.40-27.07L267.40-27.07Q268.59-23.52 268.59-19.37L268.59-19.37L268.59-18.63L268.59-18.63Q268.59-14.45 267.42-10.92L267.42-10.92L267.42-10.92Q266.24-7.38 263.92-4.80L263.92-4.80L263.92-4.80Q261.60-2.21 258.17-0.76L258.17-0.76L258.17-0.76Q254.74 0.70 250.28 0.70L250.28 0.70L250.28 0.70Q245.81 0.70 242.38-0.76L242.38-0.76L242.38-0.76Q238.96-2.21 236.62-4.80L236.62-4.80L236.62-4.80Q234.28-7.38 233.09-10.92L233.09-10.92L233.09-10.92Q231.89-14.45 231.89-18.63L231.89-18.63M243.74-19.37L243.74-18.63L243.74-18.63Q243.74-16.49 244.04-14.63L244.04-14.63L244.04-14.63Q244.34-12.76 245.09-11.39L245.09-11.39L245.09-11.39Q245.85-10.02 247.11-9.23L247.11-9.23L247.11-9.23Q248.38-8.44 250.28-8.44L250.28-8.44L250.28-8.44Q252.14-8.44 253.39-9.23L253.39-9.23L253.39-9.23Q254.64-10.02 255.38-11.39L255.38-11.39L255.38-11.39Q256.11-12.76 256.43-14.63L256.43-14.63L256.43-14.63Q256.75-16.49 256.75-18.63L256.75-18.63L256.75-19.37L256.75-19.37Q256.75-21.45 256.45-23.31L256.45-23.31L256.45-23.31Q256.15-25.17 255.39-26.56L255.39-26.56L255.39-26.56Q254.64-27.95 253.37-28.78L253.37-28.78L253.37-28.78Q252.11-29.60 250.21-29.60L250.21-29.60L250.21-29.60Q248.34-29.60 247.10-28.78L247.10-28.78L247.10-28.78Q245.85-27.95 245.11-26.56L245.11-26.56L245.11-26.56Q244.37-25.17 244.05-23.31L244.05-23.31L244.05-23.31Q243.74-21.45 243.74-19.37L243.74-19.37ZM297.04-38.32L296.82-27.32L296.82-27.32Q296.47-27.35 295.96-27.40L295.96-27.40L295.96-27.40Q295.45-27.46 294.91-27.49L294.91-27.49L294.91-27.49Q294.36-27.53 293.84-27.56L293.84-27.56L293.84-27.56Q293.31-27.60 292.92-27.60L292.92-27.60L292.92-27.60Q290.07-27.60 288.32-26.74L288.32-26.74L288.32-26.74Q286.56-25.88 285.75-24.08L285.75-24.08L285.75 0L273.90 0L273.90-38.04L285.01-38.04L285.40-33.15L285.40-33.15Q286.80-35.79 288.90-37.27L288.90-37.27L288.90-37.27Q290.99-38.74 293.73-38.74L293.73-38.74L293.73-38.74Q294.61-38.74 295.47-38.64L295.47-38.64L295.47-38.64Q296.33-38.53 297.04-38.32L297.04-38.32ZM313.59-54L313.59 0L301.71 0L301.71-54L313.59-54ZM319.39-18.56L319.39-19.30L319.39-19.30Q319.39-23.63 320.34-27.21L320.34-27.21L320.34-27.21Q321.29-30.80 323.16-33.36L323.16-33.36L323.16-33.36Q325.02-35.93 327.78-37.34L327.78-37.34L327.78-37.34Q330.54-38.74 334.20-38.74L334.20-38.74L334.20-38.74Q336.90-38.74 339.01-37.69L339.01-37.69L339.01-37.69Q341.12-36.63 342.77-34.73L342.77-34.73L342.77-54L354.66-54L354.66 0L344.00 0L343.41-4.08L343.41-4.08Q341.72-1.86 339.43-0.58L339.43-0.58L339.43-0.58Q337.15 0.70 334.13 0.70L334.13 0.70L334.13 0.70Q330.50 0.70 327.76-0.76L327.76-0.76L327.76-0.76Q325.02-2.21 323.16-4.78L323.16-4.78L323.16-4.78Q321.29-7.35 320.34-10.88L320.34-10.88L320.34-10.88Q319.39-14.41 319.39-18.56L319.39-18.56M331.24-19.30L331.24-18.56L331.24-18.56Q331.24-16.42 331.52-14.57L331.52-14.57L331.52-14.57Q331.80-12.73 332.49-11.36L332.49-11.36L332.49-11.36Q333.18-9.98 334.32-9.21L334.32-9.21L334.32-9.21Q335.46-8.44 337.15-8.44L337.15-8.44L337.15-8.44Q339.15-8.44 340.56-9.30L340.56-9.30L340.56-9.30Q341.96-10.16 342.77-11.74L342.77-11.74L342.77-26.23L342.77-26.23Q341.16-29.60 337.22-29.60L337.22-29.60L337.22-29.60Q335.57-29.60 334.42-28.83L334.42-28.83L334.42-28.83Q333.28-28.05 332.58-26.67L332.58-26.67L332.58-26.67Q331.88-25.28 331.56-23.40L331.56-23.40L331.56-23.40Q331.24-21.52 331.24-19.30L331.24-19.30Z"}]
    [:line {:x1 354.65625 :x2 354.65625 :y0 0 :y1 height :stroke "red" }]
    #_[:line {:x1 355.65625 :x2 355.65625 :y0 0 :y1 height :stroke "red" }]
    ]])

(defn render-self []
  (render "hello.svg" (diagram)))